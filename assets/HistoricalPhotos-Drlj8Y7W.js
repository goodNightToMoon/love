import{_ as q,w as Y,o as G,a as J,c as r,b as h,d as C,u as N,e as v,F as I,r as R,f as S,n as K,g as H,h as M,i as l,E as Q,j as X,k as o,p as Z,l as ee,m as te,q as le,s as ae,t as oe}from"./index-DptZZeoZ.js";import{E as se}from"./el-alert-cMJCFidf.js";const ne={class:"image-desc"},re={key:0,class:"loading-tip"},ie={key:1,class:"loading-tip"},ue={__name:"HistoricalPhotos",setup(ce){const W=l(null),U=l(null),O=l([]),k=l([]),P=l([]),d=l([]),_=l(1),g=l(10),p=l(!1),T=l(!1),B=l(!1),i=l(null),E=l(window.innerWidth),x=l([]),w=l([]);let y=l(""),V=null;function j(){H(()=>import("./historyPicture-KnvQzXlo.js"),[]).then(e=>{x.value=e.default}),H(()=>import("./alertList-Cd_iOZK8.js"),[]).then(e=>{w.value=e.default,y.value=w.value[0]}),H(()=>import("./banner-D9HeJCFM.js"),[]).then(e=>{P.value=e.default.slice(0,4)})}const b=X(()=>E.value<768?2:4),z=async()=>{if(!(p.value||T.value)){p.value=!0,y.value=w.value[_.value-1];try{await new Promise(c=>setTimeout(c,800));let e=_.value*g.value-g.value,t=g.value+e;const m=x.value.slice(e,t).map((c,s)=>{const a=(_.value-1)*g.value+s+1,n=Math.floor(Math.random()*200)+100;return{id:a,title:`珍藏 ${a}`,imgUrl:c,height:n}});d.value=[...d.value,...m],d.value.length>=x.value.length&&(T.value=!0,V=setTimeout(()=>{y.value=w.value[w.value.length-1]},3e3)),_.value++,await M(),L()}catch(e){console.error("获取瀑布流图片失败：",e)}finally{p.value=!1}}},L=()=>{const e=b.value;if(e<=0||d.value.length===0)return;k.value=Array(e).fill().map(()=>[]);let t=Array(e).fill(0);d.value.forEach((u,m)=>{const c=t.every(a=>a===0);let s=0;if(c)s=m%e;else{const a=Math.min(...t);s=t.findIndex(n=>n===a)}k.value[s].push(u),t[s]+=u.height+(E.value<768?12:16)})},F=()=>{console.log("图片预览已关闭")},A=()=>{i.value||(i.value=setTimeout(()=>{const e=window.innerHeight,t=window.scrollY,u=document.documentElement.scrollHeight;t+e>=u-300&&!p.value&&z(),B.value=t>500,clearTimeout(i.value),i.value=null},200))},D=()=>{E.value=window.innerWidth,clearTimeout(i.value),i.value=setTimeout(()=>{M(()=>{L()})},300)},$=()=>{window.scrollTo({top:0,behavior:"smooth"})};return Y(b,()=>{M(()=>{L()})}),G(()=>{j(),z(),window.addEventListener("scroll",A),window.addEventListener("resize",D)}),J(()=>{window.removeEventListener("scroll",A),window.removeEventListener("resize",D),clearTimeout(i.value),clearTimeout(V)}),(e,t)=>{const u=se,m=le,c=te,s=Q;return o(),r("div",{class:"waterfall-page-container",ref_key:"pageContainerRef",ref:W},[h(u,{title:N(y),type:"primary",center:"","show-icon":"",class:"topfixed",closable:!1},{icon:C(()=>[h(N(Z))]),_:1},8,["title"]),h(s,{height:"300px",arrow:"hover",class:"top-carousel",autoplay:!0,interval:2500},{default:C(()=>[(o(!0),r(I,null,R(P.value,(a,n)=>(o(),ee(c,{key:n},{default:C(()=>[h(m,{src:a,alt:`轮播图 ${n+1}`,class:"carousel-img",fit:"cover"},null,8,["src","alt"])]),_:2},1024))),128))]),_:1}),v("div",{class:"waterfall-container",ref_key:"waterfallRef",ref:U},[(o(!0),r(I,null,R(k.value,(a,n)=>(o(),r("div",{class:"waterfall-column",key:n,ref_for:!0,ref_key:"columnRefs",ref:O},[(o(!0),r(I,null,R(a,f=>(o(),r("div",{class:"waterfall-image-item",key:f.id},[h(m,{src:f.imgUrl,style:ae({height:f.height+"px"}),alt:f.title,class:"waterfall-img",fit:"cover","preview-src-list":[f.imgUrl],"preview-options":{loop:!1,onClose:F}},null,8,["src","style","alt","preview-src-list","preview-options"]),v("p",ne,oe(f.title),1)]))),128))]))),128))],512),p.value?(o(),r("div",re,[...t[0]||(t[0]=[v("p",{class:"loading-text"},"正在加载更多图片...",-1)])])):S("",!0),T.value&&d.value.length>0?(o(),r("div",ie,[...t[1]||(t[1]=[v("p",{class:"loading-text"},"已经加载全部图片啦～",-1)])])):S("",!0),v("button",{class:K(["back-to-top-btn",{show:B.value}]),onClick:$},[...t[2]||(t[2]=[v("svg",{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"},[v("path",{d:"M12 19V5M12 5L5 12M12 5L19 12",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})],-1)])],2)],512)}}},me=q(ue,[["__scopeId","data-v-37ec2204"]]);export{me as default};
